<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Field Marketing Dashboard - Enhanced</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📊</text></svg>">
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.7.2/umd/Recharts.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', system-ui, sans-serif;
        }
        
        .btn-primary {
            @apply bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors font-medium;
        }
        
        .btn-secondary {
            @apply bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 disabled:opacity-50 transition-colors font-medium;
        }
        
        .btn-success {
            @apply bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium;
        }
        
        .btn-danger {
            @apply bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors font-medium;
        }
        
        .card {
            @apply bg-white rounded-xl shadow-lg p-6;
        }
        
        .input-field {
            @apply w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors;
        }
        
        .status-badge {
            @apply px-2 py-1 rounded text-xs font-medium;
        }
        
        .status-visited {
            @apply bg-green-100 text-green-800;
        }
        
        .status-no-call {
            @apply bg-yellow-100 text-yellow-800;
        }
        
        .status-not-available {
            @apply bg-red-100 text-red-800;
        }
        
        .loading-spinner {
            @apply animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .animate-slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // Enhanced Configuration
        const CONFIG = {
            GOOGLE_APPS_SCRIPT_URL: 'YOUR_NEW_GOOGLE_APPS_SCRIPT_URL_HERE',
            SHEET_ID: 'YOUR_GOOGLE_SHEET_ID_HERE',
            APP_NAME: 'Field Marketing Dashboard',
            COMPANY_NAME: 'Stellar Healthcare Pvt. Ltd',
            VERSION: '2.0.0',
            MESSAGE_TIMEOUT: 5000,
            AUTO_REFRESH_INTERVAL: 30000
        };

        const { useState, useEffect, useCallback, useMemo } = React;
        
        // Check if Recharts is available
        const RechartsComponents = window.Recharts || {};
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, BarChart, Bar, PieChart, Pie, Cell } = RechartsComponents;

        // Enhanced API Service with better error handling
        class APIService {
            constructor() {
                this.cache = new Map();
                this.offlineQueue = [];
                this.debugMode = true; // Set to false in production
            }

            log(message, data = null) {
                if (this.debugMode) {
                    console.log(`[API Service] ${message}`, data || '');
                }
            }

            async request(endpoint, options = {}) {
                const url = endpoint.startsWith('http') ? endpoint : `${CONFIG.GOOGLE_APPS_SCRIPT_URL}${endpoint}`;
                
                this.log(`Making request to: ${url}`, { method: options.method || 'GET', options });
                
                const defaultOptions = {
                    headers: { 'Content-Type': 'application/json' },
                    mode: 'cors'
                };

                const requestOptions = { ...defaultOptions, ...options };

                try {
                    const response = await fetch(url, requestOptions);
                    
                    this.log(`Response status: ${response.status}`, { 
                        ok: response.ok, 
                        statusText: response.statusText,
                        headers: Object.fromEntries(response.headers.entries())
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        this.log(`Error response body: ${errorText}`);
                        throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`);
                    }

                    const contentType = response.headers.get('content-type');
                    const result = contentType && contentType.includes('application/json') 
                        ? await response.json() 
                        : await response.text();
                    
                    this.log(`Response data:`, result);
                    return result;
                } catch (error) {
                    this.log(`API Error:`, error);
                    
                    // Fallback to JSONP for GET requests
                    if (options.method === 'GET' || !options.method) {
                        this.log('Attempting JSONP fallback...');
                        return this.jsonpRequest(url);
                    }
                    
                    throw error;
                }
            }

            // JSONP fallback for CORS issues
            jsonpRequest(url) {
                return new Promise((resolve, reject) => {
                    const callbackName = 'jsonpCallback_' + Math.random().toString(36).substr(2, 9);
                    const script = document.createElement('script');
                    
                    window[callbackName] = (data) => {
                        delete window[callbackName];
                        document.body.removeChild(script);
                        resolve(data);
                    };
                    
                    script.onerror = () => {
                        delete window[callbackName];
                        document.body.removeChild(script);
                        reject(new Error('JSONP request failed'));
                    };
                    
                    const separator = url.includes('?') ? '&' : '?';
                    script.src = `${url}${separator}callback=${callbackName}`;
                    document.body.appendChild(script);
                });
            }

            async getEntries() {
                try {
                    const data = await this.request('?action=get');
                    
                    if (!Array.isArray(data)) {
                        throw new Error('Invalid data format received');
                    }

                    const formattedEntries = data.map((row, index) => ({
                        id: index + 1,
                        date: row.Date || '',
                        officerName: row['Officer Name'] || '',
                        plannedAreas: row['Planned Areas'] || '',
                        actualAreas: row['Actual Areas'] || '',
                        doctorsVisited: this.parseListField(row['Doctors Visited'], 'doctor'),
                        pharmaciesVisited: this.parseListField(row['Pharmacies Visited'], 'pharmacy'),
                        orders: this.parseListField(row['Orders'], 'order'),
                        returns: this.parseListField(row['Returns'], 'return'),
                        notes: row['Notes'] || '',
                        timestamp: row['Timestamp']
                    }));

                    this.cache.set('entries', { data: formattedEntries, timestamp: Date.now() });
                    return formattedEntries;
                } catch (error) {
                    console.warn('Using demo data due to API error:', error);
                    
                    // Return demo data if API fails
                    return this.getDemoData();
                }
            }

            getDemoData() {
                return [
                    {
                        id: 1,
                        date: '2024-01-15',
                        officerName: 'Demo Officer',
                        plannedAreas: 'Downtown Medical District',
                        actualAreas: 'Downtown Medical District, Central Hospital',
                        doctorsVisited: [
                            { name: 'Dr. Smith', location: 'Central Hospital', specialty: 'Cardiology', status: 'visited' },
                            { name: 'Dr. Johnson', location: 'Medical Center', specialty: 'Pediatrics', status: 'visited' }
                        ],
                        pharmaciesVisited: [
                            { name: 'City Pharmacy', location: 'Downtown', status: 'visited' },
                            { name: 'Health Plus', location: 'Central', status: 'visited' }
                        ],
                        orders: [
                            { item: 'Medicine A', quantity: '50', location: 'City Pharmacy' },
                            { item: 'Medicine B', quantity: '30', location: 'Health Plus' }
                        ],
                        returns: [
                            { item: 'Expired Medicine', quantity: '5', reason: 'Expired' }
                        ],
                        notes: 'Successful day with good response from doctors.',
                        timestamp: '2024-01-15T10:30:00Z'
                    }
                ];
            }

            async addEntry(entryData) {
                const formattedEntry = {
                    action: 'add',
                    data: {
                        Date: entryData.date,
                        'Officer Name': entryData.officerName,
                        'Planned Areas': entryData.plannedAreas,
                        'Actual Areas': entryData.actualAreas,
                        'Doctors Visited': this.formatListField(entryData.doctorsVisited, 'doctor'),
                        'Pharmacies Visited': this.formatListField(entryData.pharmaciesVisited, 'pharmacy'),
                        'Orders': this.formatListField(entryData.orders, 'order'),
                        'Returns': this.formatListField(entryData.returns, 'return'),
                        'Notes': entryData.notes,
                        'Timestamp': new Date().toISOString()
                    }
                };

                const result = await this.request('', {
                    method: 'POST',
                    body: JSON.stringify(formattedEntry)
                });

                if (result.success || result.status === 'success') {
                    this.cache.delete('entries');
                    return result;
                } else {
                    throw new Error(result.message || 'Failed to save entry');
                }
            }

            parseListField(field, type = 'generic') {
                if (!field) return [];
                
                return field.split('; ')
                    .filter(item => item.trim())
                    .map(item => {
                        const trimmed = item.trim();
                        switch (type) {
                            case 'doctor':
                                return this.parseDoctorField(trimmed);
                            case 'pharmacy':
                                return this.parsePharmacyField(trimmed);
                            case 'order':
                                return this.parseOrderField(trimmed);
                            case 'return':
                                return this.parseReturnField(trimmed);
                            default:
                                return { name: trimmed };
                        }
                    });
            }

            parseDoctorField(field) {
                const match = field.match(/^(.+?)\s*\((.+?)(?:,\s*(.+?))?\s*\)\s*-\s*(.+)$/);
                return match ? {
                    name: match[1].trim(),
                    location: match[2].trim(),
                    specialty: match[3]?.trim() || '',
                    status: match[4].trim()
                } : { name: field };
            }

            parsePharmacyField(field) {
                const match = field.match(/^(.+?)\s*\((.+?)\)\s*-\s*(.+)$/);
                return match ? {
                    name: match[1].trim(),
                    location: match[2].trim(),
                    status: match[3].trim()
                } : { name: field };
            }

            parseOrderField(field) {
                const match = field.match(/^(.+?)\s*-\s*(.+?)(?:\s*\((.+?)\))?$/);
                return match ? {
                    item: match[1].trim(),
                    quantity: match[2].trim(),
                    location: match[3]?.trim() || ''
                } : { item: field };
            }

            parseReturnField(field) {
                const match = field.match(/^(.+?)\s*-\s*(.+?)(?:\s*\((.+?)\))?$/);
                return match ? {
                    item: match[1].trim(),
                    quantity: match[2].trim(),
                    reason: match[3]?.trim() || ''
                } : { item: field };
            }

            formatListField(items, type = 'generic') {
                return items.map(item => {
                    switch (type) {
                        case 'doctor':
                            return `${item.name} (${item.location}${item.specialty ? ', ' + item.specialty : ''}) - ${item.status}`;
                        case 'pharmacy':
                            return `${item.name} (${item.location}) - ${item.status}`;
                        case 'order':
                            return `${item.item} - ${item.quantity}${item.location ? ' (' + item.location + ')' : ''}`;
                        case 'return':
                            return `${item.item} - ${item.quantity}${item.reason ? ' (' + item.reason + ')' : ''}`;
                        default:
                            return item.name || item.item || item;
                    }
                }).join('; ');
            }
        }

        const apiService = new APIService();

        // Configuration checker
        const checkConfiguration = () => {
            const issues = [];
            
            if (!CONFIG.GOOGLE_APPS_SCRIPT_URL || CONFIG.GOOGLE_APPS_SCRIPT_URL.includes('YOUR_')) {
                issues.push('Google Apps Script URL not configured');
            }
            
            if (!CONFIG.SHEET_ID || CONFIG.SHEET_ID.includes('YOUR_')) {
                issues.push('Google Sheet ID not configured');
            }
            
            if (issues.length > 0) {
                console.warn('Configuration issues found:', issues);
                return { valid: false, issues };
            }
            
            return { valid: true, issues: [] };
        };

        // Enhanced Field Marketing Dashboard Component
        const FieldMarketingDashboard = () => {
            const [activeTab, setActiveTab] = useState('entry');
            const [entries, setEntries] = useState([]);
            const [loading, setLoading] = useState(false);
            const [saving, setSaving] = useState(false);
            const [message, setMessage] = useState('');
            const [currentEntry, setCurrentEntry] = useState({
                date: new Date().toISOString().split('T')[0],
                officerName: '',
                plannedAreas: '',
                actualAreas: '',
                doctorsVisited: [],
                pharmaciesVisited: [],
                orders: [],
                returns: [],
                notes: ''
            });

            const [newDoctor, setNewDoctor] = useState({ name: '', location: '', specialty: '', status: 'visited' });
            const [newPharmacy, setNewPharmacy] = useState({ name: '', location: '', status: 'visited' });
            const [newOrder, setNewOrder] = useState({ item: '', quantity: '', location: '' });
            const [newReturn, setNewReturn] = useState({ item: '', quantity: '', reason: '' });

            // Load data from Google Sheets
            const loadEntries = useCallback(async () => {
                setLoading(true);
                try {
                    const data = await apiService.getEntries();
                    setEntries(data);
                } catch (error) {
                    console.error('Error loading data:', error);
                    showMessage('Error loading data from Google Sheets', 'error');
                }
                setLoading(false);
            }, []);

            // Load entries on component mount
            useEffect(() => {
                // Check configuration first
                const configCheck = checkConfiguration();
                if (!configCheck.valid) {
                    showMessage(`Configuration issues: ${configCheck.issues.join(', ')}. Please check SETUP_GUIDE.md`, 'error');
                }
                
                loadEntries();
                
                // Auto-refresh every 30 seconds
                const interval = setInterval(loadEntries, CONFIG.AUTO_REFRESH_INTERVAL);
                return () => clearInterval(interval);
            }, [loadEntries]);

            const showMessage = (msg, type = 'success') => {
                setMessage(msg);
                setTimeout(() => setMessage(''), CONFIG.MESSAGE_TIMEOUT);
            };

            const refreshData = () => {
                loadEntries();
                showMessage('Data refreshed from Google Sheets!', 'success');
            };

            // Enhanced validation
            const validateEntry = (entry) => {
                const errors = {};
                
                if (!entry.officerName?.trim()) {
                    errors.officerName = 'Officer name is required';
                }
                
                if (!entry.date) {
                    errors.date = 'Date is required';
                } else {
                    const date = new Date(entry.date);
                    if (date > new Date()) {
                        errors.date = 'Date cannot be in the future';
                    }
                }
                
                return { isValid: Object.keys(errors).length === 0, errors };
            };

            const addDoctor = () => {
                if (newDoctor.name && newDoctor.location) {
                    setCurrentEntry(prev => ({
                        ...prev,
                        doctorsVisited: [...prev.doctorsVisited, { ...newDoctor, id: Date.now() }]
                    }));
                    setNewDoctor({ name: '', location: '', specialty: '', status: 'visited' });
                }
            };

            const addPharmacy = () => {
                if (newPharmacy.name && newPharmacy.location) {
                    setCurrentEntry(prev => ({
                        ...prev,
                        pharmaciesVisited: [...prev.pharmaciesVisited, { ...newPharmacy, id: Date.now() }]
                    }));
                    setNewPharmacy({ name: '', location: '', status: 'visited' });
                }
            };

            const addOrder = () => {
                if (newOrder.item && newOrder.quantity) {
                    setCurrentEntry(prev => ({
                        ...prev,
                        orders: [...prev.orders, { ...newOrder, id: Date.now() }]
                    }));
                    setNewOrder({ item: '', quantity: '', location: '' });
                }
            };

            const addReturn = () => {
                if (newReturn.item && newReturn.quantity) {
                    setCurrentEntry(prev => ({
                        ...prev,
                        returns: [...prev.returns, { ...newReturn, id: Date.now() }]
                    }));
                    setNewReturn({ item: '', quantity: '', reason: '' });
                }
            };

            const saveEntry = async () => {
                const validation = validateEntry(currentEntry);
                if (!validation.isValid) {
                    showMessage(Object.values(validation.errors)[0], 'error');
                    return;
                }

                setSaving(true);
                
                try {
                    await apiService.addEntry(currentEntry);
                    showMessage('Entry saved to Google Sheets successfully!', 'success');
                    
                    // Reset form
                    setCurrentEntry({
                        date: new Date().toISOString().split('T')[0],
                        officerName: '',
                        plannedAreas: '',
                        actualAreas: '',
                        doctorsVisited: [],
                        pharmaciesVisited: [],
                        orders: [],
                        returns: [],
                        notes: ''
                    });
                    
                    // Refresh data
                    loadEntries();
                } catch (error) {
                    console.error('Error saving to Google Sheets:', error);
                    showMessage(`Error saving to Google Sheets: ${error.message}`, 'error');
                }
                
                setSaving(false);
            };

            const removeItem = (type, id) => {
                setCurrentEntry(prev => ({
                    ...prev,
                    [type]: prev[type].filter(item => item.id !== id)
                }));
            };

            // Analytics data
            const analyticsData = useMemo(() => {
                if (!entries.length) return null;

                const totalDoctors = entries.reduce((sum, entry) => sum + entry.doctorsVisited.length, 0);
                const totalPharmacies = entries.reduce((sum, entry) => sum + entry.pharmaciesVisited.length, 0);
                const totalOrders = entries.reduce((sum, entry) => sum + entry.orders.length, 0);
                const totalReturns = entries.reduce((sum, entry) => sum + entry.returns.length, 0);

                // Weekly data for charts
                const weeklyData = entries.reduce((acc, entry) => {
                    const week = new Date(entry.date).toISOString().slice(0, 10);
                    if (!acc[week]) {
                        acc[week] = { week, doctors: 0, pharmacies: 0, orders: 0, returns: 0 };
                    }
                    acc[week].doctors += entry.doctorsVisited.length;
                    acc[week].pharmacies += entry.pharmaciesVisited.length;
                    acc[week].orders += entry.orders.length;
                    acc[week].returns += entry.returns.length;
                    return acc;
                }, {});

                return {
                    summary: { totalDoctors, totalPharmacies, totalOrders, totalReturns },
                    weeklyData: Object.values(weeklyData).slice(-7) // Last 7 weeks
                };
            }, [entries]);

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                    <div className="container mx-auto px-4 py-8">
                        {/* Enhanced Header */}
                        <div className="card mb-6">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-800 mb-2">{CONFIG.APP_NAME}</h1>
                                    <p className="text-gray-600">Powered by {CONFIG.COMPANY_NAME} - v{CONFIG.VERSION}</p>
                                    {/* Configuration Status */}
                                    {(() => {
                                        const configCheck = checkConfiguration();
                                        return configCheck.valid ? (
                                            <p className="text-green-600 text-sm mt-1">✅ Google Sheets connected</p>
                                        ) : (
                                            <div className="mt-1">
                                                <p className="text-red-600 text-sm">⚠️ Configuration issues detected</p>
                                                <button
                                                    onClick={() => {
                                                        const issues = configCheck.issues.join(', ');
                                                        showMessage(`Configuration issues: ${issues}. Please check SETUP_GUIDE.md`, 'error');
                                                    }}
                                                    className="text-blue-600 text-xs underline hover:text-blue-800"
                                                >
                                                    View Details
                                                </button>
                                            </div>
                                        );
                                    })()}
                                </div>
                                <div className="flex items-center space-x-2">
                                    <button
                                        onClick={refreshData}
                                        disabled={loading}
                                        className="btn-primary"
                                    >
                                        {loading ? 'Loading...' : '🔄 Refresh Data'}
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Enhanced Message Display */}
                        {message && (
                            <div className={`rounded-lg p-4 mb-6 animate-fade-in ${
                                message.includes('Error') ? 'bg-red-100 text-red-800' :
                                message.includes('Demo') || message.includes('Configure') ? 'bg-yellow-100 text-yellow-800' :
                                'bg-green-100 text-green-800'
                            }`}>
                                <div className="flex items-center">
                                    <span className="w-5 h-5 mr-2">
                                        {message.includes('Error') ? '⚠️' : 
                                         message.includes('Demo') ? '⏰' : '✅'}
                                    </span>
                                    {message}
                                </div>
                            </div>
                        )}

                        {/* Enhanced Navigation Tabs */}
                        <div className="card mb-6">
                            <div className="flex border-b border-gray-200">
                                <button
                                    onClick={() => setActiveTab('entry')}
                                    className={`px-6 py-4 font-medium rounded-tl-xl transition-colors ${
                                        activeTab === 'entry'
                                            ? 'bg-blue-500 text-white'
                                            : 'text-gray-600 hover:text-blue-500'
                                    }`}
                                >
                                    ➕ New Entry
                                </button>
                                <button
                                    onClick={() => setActiveTab('view')}
                                    className={`px-6 py-4 font-medium transition-colors ${
                                        activeTab === 'view'
                                            ? 'bg-blue-500 text-white'
                                            : 'text-gray-600 hover:text-blue-500'
                                    }`}
                                >
                                    👁️ View Entries ({entries.length})
                                </button>
                                <button
                                    onClick={() => setActiveTab('analytics')}
                                    className={`px-6 py-4 font-medium rounded-tr-xl transition-colors ${
                                        activeTab === 'analytics'
                                            ? 'bg-blue-500 text-white'
                                            : 'text-gray-600 hover:text-blue-500'
                                    }`}
                                >
                                    📊 Analytics
                                </button>
                            </div>
                        </div>

                        {/* Entry Form */}
                        {activeTab === 'entry' && (
                            <div className="card animate-slide-up">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">Daily Activity Entry</h2>
                                
                                {/* Basic Information */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            📅 Date *
                                        </label>
                                        <input
                                            type="date"
                                            value={currentEntry.date}
                                            onChange={(e) => setCurrentEntry(prev => ({ ...prev, date: e.target.value }))}
                                            className="input-field"
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            👤 Officer Name *
                                        </label>
                                        <input
                                            type="text"
                                            value={currentEntry.officerName}
                                            onChange={(e) => setCurrentEntry(prev => ({ ...prev, officerName: e.target.value }))}
                                            className="input-field"
                                            placeholder="Enter your name"
                                            required
                                        />
                                    </div>
                                </div>

                                {/* Areas */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            📍 Planned Areas to Work
                                        </label>
                                        <textarea
                                            value={currentEntry.plannedAreas}
                                            onChange={(e) => setCurrentEntry(prev => ({ ...prev, plannedAreas: e.target.value }))}
                                            className="input-field"
                                            rows="3"
                                            placeholder="List the areas you plan to visit"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            📍 Actual Areas Worked
                                        </label>
                                        <textarea
                                            value={currentEntry.actualAreas}
                                            onChange={(e) => setCurrentEntry(prev => ({ ...prev, actualAreas: e.target.value }))}
                                            className="input-field"
                                            rows="3"
                                            placeholder="List the areas you actually visited"
                                        />
                                    </div>
                                </div>

                                {/* Doctors Visited */}
                                <div className="mb-8">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">👨‍⚕️ Doctors Visited</h3>
                                    <div className="bg-gray-50 p-4 rounded-lg mb-4">
                                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                                            <input
                                                type="text"
                                                value={newDoctor.name}
                                                onChange={(e) => setNewDoctor(prev => ({ ...prev, name: e.target.value }))}
                                                placeholder="Doctor Name"
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                            <input
                                                type="text"
                                                value={newDoctor.location}
                                                onChange={(e) => setNewDoctor(prev => ({ ...prev, location: e.target.value }))}
                                                placeholder="Hospital/Clinic"
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                            <input
                                                type="text"
                                                value={newDoctor.specialty}
                                                onChange={(e) => setNewDoctor(prev => ({ ...prev, specialty: e.target.value }))}
                                                placeholder="Specialty"
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                            <select
                                                value={newDoctor.status}
                                                onChange={(e) => setNewDoctor(prev => ({ ...prev, status: e.target.value }))}
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            >
                                                <option value="visited">Visited</option>
                                                <option value="no_call">No Call</option>
                                                <option value="not_available">Not Available</option>
                                            </select>
                                        </div>
                                        <button
                                            onClick={addDoctor}
                                            className="btn-primary"
                                        >
                                            ➕ Add Doctor
                                        </button>
                                    </div>
                                    
                                    {currentEntry.doctorsVisited.length > 0 && (
                                        <div className="space-y-2">
                                            {currentEntry.doctorsVisited.map((doctor) => (
                                                <div key={doctor.id} className="flex items-center justify-between bg-white p-3 rounded-lg border">
                                                    <div>
                                                        <span className="font-medium">{doctor.name}</span>
                                                        <span className="text-gray-600 ml-2">- {doctor.location}</span>
                                                        {doctor.specialty && <span className="text-gray-500 ml-2">({doctor.specialty})</span>}
                                                        <span className={`ml-2 status-badge ${
                                                            doctor.status === 'visited' ? 'status-visited' :
                                                            doctor.status === 'no_call' ? 'status-no-call' :
                                                            'status-not-available'
                                                        }`}>
                                                            {doctor.status.replace('_', ' ')}
                                                        </span>
                                                    </div>
                                                    <button
                                                        onClick={() => removeItem('doctorsVisited', doctor.id)}
                                                        className="text-red-500 hover:text-red-700"
                                                    >
                                                        Remove
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Pharmacies Visited */}
                                <div className="mb-8">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">🏥 Pharmacies Visited</h3>
                                    <div className="bg-gray-50 p-4 rounded-lg mb-4">
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                            <input
                                                type="text"
                                                value={newPharmacy.name}
                                                onChange={(e) => setNewPharmacy(prev => ({ ...prev, name: e.target.value }))}
                                                placeholder="Pharmacy Name"
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                            <input
                                                type="text"
                                                value={newPharmacy.location}
                                                onChange={(e) => setNewPharmacy(prev => ({ ...prev, location: e.target.value }))}
                                                placeholder="Location"
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                            <select
                                                value={newPharmacy.status}
                                                onChange={(e) => setNewPharmacy(prev => ({ ...prev, status: e.target.value }))}
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            >
                                                <option value="visited">Visited</option>
                                                <option value="no_call">No Call</option>
                                                <option value="not_available">Not Available</option>
                                            </select>
                                        </div>
                                        <button
                                            onClick={addPharmacy}
                                            className="btn-success"
                                        >
                                            ➕ Add Pharmacy
                                        </button>
                                    </div>
                                    
                                    {currentEntry.pharmaciesVisited.length > 0 && (
                                        <div className="space-y-2">
                                            {currentEntry.pharmaciesVisited.map((pharmacy) => (
                                                <div key={pharmacy.id} className="flex items-center justify-between bg-white p-3 rounded-lg border">
                                                    <div>
                                                        <span className="font-medium">{pharmacy.name}</span>
                                                        <span className="text-gray-600 ml-2">- {pharmacy.location}</span>
                                                        <span className={`ml-2 status-badge ${
                                                            pharmacy.status === 'visited' ? 'status-visited' :
                                                            pharmacy.status === 'no_call' ? 'status-no-call' :
                                                            'status-not-available'
                                                        }`}>
                                                            {pharmacy.status.replace('_', ' ')}
                                                        </span>
                                                    </div>
                                                    <button
                                                        onClick={() => removeItem('pharmaciesVisited', pharmacy.id)}
                                                        className="text-red-500 hover:text-red-700"
                                                    >
                                                        Remove
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Orders */}
                                <div className="mb-8">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">📦 Orders</h3>
                                    <div className="bg-gray-50 p-4 rounded-lg mb-4">
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                            <input
                                                type="text"
                                                value={newOrder.item}
                                                onChange={(e) => setNewOrder(prev => ({ ...prev, item: e.target.value }))}
                                                placeholder="Item Name"
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                            <input
                                                type="text"
                                                value={newOrder.quantity}
                                                onChange={(e) => setNewOrder(prev => ({ ...prev, quantity: e.target.value }))}
                                                placeholder="Quantity"
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                            <input
                                                type="text"
                                                value={newOrder.location}
                                                onChange={(e) => setNewOrder(prev => ({ ...prev, location: e.target.value }))}
                                                placeholder="Location/Pharmacy"
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                        <button
                                            onClick={addOrder}
                                            className="btn-primary"
                                        >
                                            📦 Add Order
                                        </button>
                                    </div>
                                    
                                    {currentEntry.orders.length > 0 && (
                                        <div className="space-y-2">
                                            {currentEntry.orders.map((order) => (
                                                <div key={order.id} className="flex items-center justify-between bg-white p-3 rounded-lg border">
                                                    <div>
                                                        <span className="font-medium">{order.item}</span>
                                                        <span className="text-gray-600 ml-2">- {order.quantity}</span>
                                                        {order.location && <span className="text-gray-500 ml-2">({order.location})</span>}
                                                    </div>
                                                    <button
                                                        onClick={() => removeItem('orders', order.id)}
                                                        className="text-red-500 hover:text-red-700"
                                                    >
                                                        Remove
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Returns */}
                                <div className="mb-8">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">↩️ Returns</h3>
                                    <div className="bg-gray-50 p-4 rounded-lg mb-4">
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                            <input
                                                type="text"
                                                value={newReturn.item}
                                                onChange={(e) => setNewReturn(prev => ({ ...prev, item: e.target.value }))}
                                                placeholder="Item Name"
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                            <input
                                                type="text"
                                                value={newReturn.quantity}
                                                onChange={(e) => setNewReturn(prev => ({ ...prev, quantity: e.target.value }))}
                                                placeholder="Quantity"
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                            <input
                                                type="text"
                                                value={newReturn.reason}
                                                onChange={(e) => setNewReturn(prev => ({ ...prev, reason: e.target.value }))}
                                                placeholder="Reason for Return"
                                                className="p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                        <button
                                            onClick={addReturn}
                                            className="btn-danger"
                                        >
                                            ➕ Add Return
                                        </button>
                                    </div>
                                    
                                    {currentEntry.returns.length > 0 && (
                                        <div className="space-y-2">
                                            {currentEntry.returns.map((returnItem) => (
                                                <div key={returnItem.id} className="flex items-center justify-between bg-white p-3 rounded-lg border">
                                                    <div>
                                                        <span className="font-medium">{returnItem.item}</span>
                                                        <span className="text-gray-600 ml-2">- {returnItem.quantity}</span>
                                                        {returnItem.reason && <span className="text-gray-500 ml-2">({returnItem.reason})</span>}
                                                    </div>
                                                    <button
                                                        onClick={() => removeItem('returns', returnItem.id)}
                                                        className="text-red-500 hover:text-red-700"
                                                    >
                                                        Remove
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Notes */}
                                <div className="mb-8">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        📝 Additional Notes
                                    </label>
                                    <textarea
                                        value={currentEntry.notes}
                                        onChange={(e) => setCurrentEntry(prev => ({ ...prev, notes: e.target.value }))}
                                        className="input-field"
                                        rows="4"
                                        placeholder="Any additional notes or observations..."
                                    />
                                </div>

                                {/* Save Button */}
                                <button
                                    onClick={saveEntry}
                                    disabled={saving}
                                    className="btn-primary px-8 py-3"
                                >
                                    💾 {saving ? 'Saving...' : 'Save Entry'}
                                </button>
                            </div>
                        )}

                        {/* View Entries */}
                        {activeTab === 'view' && (
                            <div className="card animate-slide-up">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">📊 Daily Activity Reports</h2>
                                
                                {loading ? (
                                    <div className="text-center py-12">
                                        <div className="loading-spinner mx-auto"></div>
                                        <p className="text-gray-500 mt-4">Loading entries from Google Sheets...</p>
                                    </div>
                                ) : entries.length === 0 ? (
                                    <div className="text-center py-12">
                                        <p className="text-gray-500 text-lg">No entries yet. Create your first entry to get started!</p>
                                    </div>
                                ) : (
                                    <div className="space-y-6">
                                        {entries.map((entry) => (
                                            <div key={entry.id} className="border border-gray-200 rounded-lg p-6 animate-fade-in">
                                                <div className="flex justify-between items-start mb-4">
                                                    <div>
                                                        <h3 className="text-lg font-semibold text-gray-800">{entry.officerName}</h3>
                                                        <p className="text-gray-600">{entry.date}</p>
                                                    </div>
                                                    {entry.timestamp && (
                                                        <p className="text-sm text-gray-500">
                                                            Submitted: {new Date(entry.timestamp).toLocaleString()}
                                                        </p>
                                                    )}
                                                </div>
                                                
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                    <div>
                                                        <h4 className="font-medium text-gray-800 mb-2">Planned Areas</h4>
                                                        <p className="text-gray-600 text-sm">{entry.plannedAreas || 'Not specified'}</p>
                                                    </div>
                                                    <div>
                                                        <h4 className="font-medium text-gray-800 mb-2">Actual Areas</h4>
                                                        <p className="text-gray-600 text-sm">{entry.actualAreas || 'Not specified'}</p>
                                                    </div>
                                                </div>
                                                
                                                <div className="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                                    <div className="bg-blue-50 p-4 rounded-lg">
                                                        <h4 className="font-medium text-blue-800 mb-2">Doctors ({entry.doctorsVisited.length})</h4>
                                                        <div className="space-y-1 text-sm">
                                                            {entry.doctorsVisited.slice(0, 3).map((doctor, idx) => (
                                                                <div key={idx} className="text-blue-700">
                                                                    {doctor.name} {doctor.location && `- ${doctor.location}`}
                                                                </div>
                                                            ))}
                                                            {entry.doctorsVisited.length > 3 && (
                                                                <div className="text-blue-600">...and {entry.doctorsVisited.length - 3} more</div>
                                                            )}
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="bg-green-50 p-4 rounded-lg">
                                                        <h4 className="font-medium text-green-800 mb-2">Pharmacies ({entry.pharmaciesVisited.length})</h4>
                                                        <div className="space-y-1 text-sm">
                                                            {entry.pharmaciesVisited.slice(0, 3).map((pharmacy, idx) => (
                                                                <div key={idx} className="text-green-700">{pharmacy.name}</div>
                                                            ))}
                                                            {entry.pharmaciesVisited.length > 3 && (
                                                                <div className="text-green-600">...and {entry.pharmaciesVisited.length - 3} more</div>
                                                            )}
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="bg-purple-50 p-4 rounded-lg">
                                                        <h4 className="font-medium text-purple-800 mb-2">Orders ({entry.orders.length})</h4>
                                                        <div className="space-y-1 text-sm">
                                                            {entry.orders.slice(0, 3).map((order, idx) => (
                                                                <div key={idx} className="text-purple-700">{order.item} {order.quantity && `- ${order.quantity}`}</div>
                                                            ))}
                                                            {entry.orders.length > 3 && (
                                                                <div className="text-purple-600">...and {entry.orders.length - 3} more</div>
                                                            )}
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="bg-red-50 p-4 rounded-lg">
                                                        <h4 className="font-medium text-red-800 mb-2">Returns ({entry.returns.length})</h4>
                                                        <div className="space-y-1 text-sm">
                                                            {entry.returns.slice(0, 3).map((returnItem, idx) => (
                                                                <div key={idx} className="text-red-700">{returnItem.item} {returnItem.quantity && `- ${returnItem.quantity}`}</div>
                                                            ))}
                                                            {entry.returns.length > 3 && (
                                                                <div className="text-red-600">...and {entry.returns.length - 3} more</div>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                {entry.notes && (
                                                    <div className="mt-4">
                                                        <h4 className="font-medium text-gray-800 mb-2">Notes</h4>
                                                        <p className="text-gray-600 text-sm">{entry.notes}</p>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Analytics Dashboard */}
                        {activeTab === 'analytics' && (
                            <div className="card animate-slide-up">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">📈 Analytics Dashboard</h2>
                                
                                {!analyticsData ? (
                                    <div className="text-center py-12">
                                        <p className="text-gray-500 text-lg">No data available for analytics. Add some entries first!</p>
                                    </div>
                                ) : (
                                    <div className="space-y-8">
                                        {/* Summary Cards */}
                                        <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                            <div className="bg-blue-50 p-6 rounded-lg">
                                                <h3 className="text-lg font-semibold text-blue-800">Total Doctors</h3>
                                                <p className="text-3xl font-bold text-blue-600">{analyticsData.summary.totalDoctors}</p>
                                            </div>
                                            <div className="bg-green-50 p-6 rounded-lg">
                                                <h3 className="text-lg font-semibold text-green-800">Total Pharmacies</h3>
                                                <p className="text-3xl font-bold text-green-600">{analyticsData.summary.totalPharmacies}</p>
                                            </div>
                                            <div className="bg-purple-50 p-6 rounded-lg">
                                                <h3 className="text-lg font-semibold text-purple-800">Total Orders</h3>
                                                <p className="text-3xl font-bold text-purple-600">{analyticsData.summary.totalOrders}</p>
                                            </div>
                                            <div className="bg-red-50 p-6 rounded-lg">
                                                <h3 className="text-lg font-semibold text-red-800">Total Returns</h3>
                                                <p className="text-3xl font-bold text-red-600">{analyticsData.summary.totalReturns}</p>
                                            </div>
                                        </div>

                                        {/* Charts */}
                                        {LineChart && BarChart ? (
                                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                                <div className="bg-white p-6 rounded-lg border">
                                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">Weekly Activity Trends</h3>
                                                    <LineChart width={400} height={300} data={analyticsData.weeklyData}>
                                                        <CartesianGrid strokeDasharray="3 3" />
                                                        <XAxis dataKey="week" />
                                                        <YAxis />
                                                        <Tooltip />
                                                        <Legend />
                                                        <Line type="monotone" dataKey="doctors" stroke="#3b82f6" name="Doctors" />
                                                        <Line type="monotone" dataKey="pharmacies" stroke="#10b981" name="Pharmacies" />
                                                    </LineChart>
                                                </div>
                                                
                                                <div className="bg-white p-6 rounded-lg border">
                                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">Orders vs Returns</h3>
                                                    <BarChart width={400} height={300} data={analyticsData.weeklyData}>
                                                        <CartesianGrid strokeDasharray="3 3" />
                                                        <XAxis dataKey="week" />
                                                        <YAxis />
                                                        <Tooltip />
                                                        <Legend />
                                                        <Bar dataKey="orders" fill="#8b5cf6" name="Orders" />
                                                        <Bar dataKey="returns" fill="#ef4444" name="Returns" />
                                                    </BarChart>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="bg-yellow-50 p-6 rounded-lg border">
                                                <h3 className="text-lg font-semibold text-yellow-800 mb-4">📊 Charts</h3>
                                                <p className="text-yellow-700">
                                                    Charts are loading... If they don't appear, please refresh the page.
                                                </p>
                                                <div className="mt-4">
                                                    <h4 className="font-medium text-yellow-800 mb-2">Weekly Summary:</h4>
                                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                        {analyticsData.weeklyData.map((week, index) => (
                                                            <div key={index} className="bg-white p-3 rounded border">
                                                                <div className="text-sm font-medium text-gray-600">{week.week}</div>
                                                                <div className="text-xs text-gray-500">
                                                                    D: {week.doctors} | P: {week.pharmacies} | O: {week.orders} | R: {week.returns}
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Render the app with error handling
        try {
            ReactDOM.render(<FieldMarketingDashboard />, document.getElementById('root'));
        } catch (error) {
            console.error('Error rendering app:', error);
            document.getElementById('root').innerHTML = `
                <div style="padding: 20px; text-align: center; font-family: Arial, sans-serif;">
                    <h1>Field Marketing Dashboard</h1>
                    <p>Loading... Please wait.</p>
                    <p style="color: #666; font-size: 14px;">If this message persists, please refresh the page.</p>
                </div>
            `;
        }
    </script>
</body>
</html> 